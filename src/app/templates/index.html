{% extends "base.html" %}

{% block app_content %}
        <div class="row">
            <div class="page-header">
                <h1 id="track-title"></h1>
                <h2 id="track-artist"></h2>
                <h2 id="track-album"></h2>
            </div>
            <div class="btn-group btn-group-lg" role="group">
                <button class="btn" id="previous"><span class="glyphicon glyphicon-step-backward" aria-hidden="true"></span> Previous</button>
                <button class="btn" id="pause"><span class="glyphicon glyphicon-pause" aria-hidden="true"></span> Pause</button>
                <button class="btn" id="next"><span class="glyphicon glyphicon-step-forward" aria-hidden="true"></span> Next</button>
            </div>
            <div class="btn-group btn-group-lg" role="group">
                <button class="btn" id="volume_down"><span class="glyphicon glyphicon-volume-down" aria-hidden="true"></span> Volume-</button>
                <button class="btn" id="volume_up"><span class="glyphicon glyphicon-volume-up" aria-hidden="true"></span> Volume+</button>
                <button class="btn" id="volume_mute"><span class="glyphicon glyphicon-volume-off" aria-hidden="true"></span> Mute</button>
            </div>
         </div>

        <div class="row">
            <div id="info" class="span12"></div>
            {% if track.image != None %}
            <div class="span6 card">
                <img id="track-image" src="{{ track.image }}">
            </div>
            {% endif %}
        </div>
        {% endblock %}

        {% block scripts %}
        {{super()}}
        <script type="text/javascript">
            var currTrack = '';
            var playing = false;
            var mute = false;

            function checkChange() {
                $.getJSON('/info-light').done(function(data) {
                    $('#track-title').text(data['title']);

                    if (currTrack != data['title'])
                    {
                        loadData();
                    }
                });
            }

            function loadData() {
                $.getJSON('/info').done(function(data) {
                    $('#track-title').text(data['title']);
                    $('#track-artist').text(data['artist']);
                    $('#track-album').text(data['album']);
                    $('.card').empty();
                    $('.card').html('<span class="image-wrap card" style="position:relative; display:inline-block; background:url(' + data['image'] + ') no-repeat center center; width: 400px; height: 400px;" /><img style="opacity:0" id="track-image" src="' + data['image'] + '"></span>');

                    currTrack = data['title'];
                    playing = data['playing'];
                    mute = data['mute'];
                });
            }

            $(document).ready(function() {
                loadData();

                $("img").load(function() {
                    $(this).wrap(function(){
                        return '<span class="image-wrap ' + $(this).attr('class') + '" style="position:relative; display:inline-block; background:url(' + $(this).attr('src') + ') no-repeat center center; width: ' + $(this).width() + 'px; height: ' + $(this).height() + 'px;" />';
                    });
                    $(this).css("opacity","0");
                });

                setInterval("checkChange()", 1000);

                $('#next').click(function() {
                    $.ajax('/next');
                    loadData();
                });

                $('#previous').click(function() {
                    $.ajax('/previous');
                    loadData();
                });

                $('#pause').click(function() {
                    if (playing == true)
                    {
                        $.ajax('/pause');
                        playing = false;

                        $('#pause').html('<span class="glyphicon glyphicon-play" aria-hidden="true"></span> Play');
                    }
                    else {
                        $.ajax('/play');
                        playing = true;

                        $('#pause').html('<span class="glyphicon glyphicon-pause" aria-hidden="true"></span> Pause');
                    }
                });

                $('#volume_down').click(function () {
                    $.ajax('/volume_down');
                    if (mute == true) {
                        $.ajax('/volume_unmute');
                        mute = false;
                        $('#volume_mute').html('<span class="glyphicon glyphicon-volume-off" aria-hidden="true"></span> Mute');
                    }
                });

                $('#volume_up').click(function () {
                    $.ajax('/volume_up');
                    if (mute == true) {
                        $.ajax('/volume_unmute');
                        mute = false;
                        $('#volume_mute').html('<span class="glyphicon glyphicon-volume-off" aria-hidden="true"></span> Mute');
                    }
                });

                $('#volume_mute').click(function () {
                    if (mute == true) {
                        $.ajax('/volume_unmute');
                        mute = false;
                        $('#volume_mute').html('<span class="glyphicon glyphicon-volume-off" aria-hidden="true"></span> Mute');
                    }
                    else {
                        $.ajax('/volume_mute');
                        mute = true;
                        $('#volume_mute').html('<span class="glyphicon glyphicon-volume-off" aria-hidden="true"></span> Unmute');
                    }
                });

                $('#track_01').click(function () {
                    $.ajax('/track_01');
                });

                $('#track_02').click(function () {
                    $.ajax('/track_02');
                });

                $('#track_03').click(function () {
                    $.ajax('/track_03');
                });

                $('#track_04').click(function () {
                    $.ajax('/track_04');
                });

            });
        </script>
        {% endblock %}